#!/usr/bin/env bash
set -euo pipefail

echo "==> Checking gofmt -s..."
GOFMT_OUT=$(gofmt -s -l .)
if [ -n "$GOFMT_OUT" ]; then
    echo "    The following files are not gofmt -s formatted:"
    echo "$GOFMT_OUT"
    echo "    Run: gofmt -s -w ."
    exit 1
fi

echo "==> Running go vet..."
go vet ./...

echo "==> Running tests..."
go test -race ./...

echo "==> Running golangci-lint..."
if command -v golangci-lint &> /dev/null; then
    golangci-lint run ./...
else
    echo "    golangci-lint not found, skipping (install: brew install golangci-lint)"
fi

echo "==> All pre-commit checks passed."
